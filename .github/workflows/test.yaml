name: CI

on: [push]

jobs:
  test:
    runs-on: ubuntu-18.04
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Test swiftbox version
      run: |
        chmod +x swiftbox.sh
        ./swiftbox.sh version

    - name: Test swiftbox lookup
      run: ./swiftbox.sh lookup 5.1.5

    - name: Test swiftbox get
      run: |
        ./swiftbox.sh get 5.1.5
        ./swiftbox.sh get 5.0
        sudo ./swiftbox.sh get 5.1.2

    - name: Test swiftbox list and use
      run: |
        ./swiftbox.sh list
        sudo ./swiftbox.sh list
        ./swiftbox.sh use 5.0
        ./swiftbox.sh list

    - name: Test swiftbox clean
      run: |
        ./swiftbox.sh clean
        sudo ./swiftbox.sh clean

    - name: Test swiftbox remove
      run: |
        sudo ./swiftbox.sh remove 5.1.2
        ./swiftbox.sh remove 5.0
        ./swiftbox.sh use 5.1.2

    - name: Test Swift status
      run: |
        source $HOME/.swiftbox/env.sh
        hash -r
        echo "\$PATH=$PATH"
        which swift
        swiftc -v

    - name: Test Swift compiler
      run: |
        source $HOME/.swiftbox/env.sh
        hash -r
        swift test.swift
        swiftc test.swift -o test && ./test

    - name: Test swiftbox disable
      run: |
        source $HOME/.swiftbox/env.sh
        hash -r
        ./swiftbox.sh disable
        hash swift 2>/dev/null
        if [ $? -eq 0 ]
        then
          exit 1
        fi

    - name: Test swiftbox install and update
      run: |
        sh -c "$(wget -q -O- https://raw.githubusercontent.com/stevapple/swiftbox/master/install.sh)"
        swiftbox version
        swiftbox update